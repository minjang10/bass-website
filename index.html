<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASS</title>
    <link rel="icon" href="assets/bass.png" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --border-color: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-dark);
            line-height: 1.6;
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-content {
            max-width: 90%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            text-decoration: none;
        }

        .logo-img {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        main {
            margin-top: 80px;
        }

        .container {
            max-width: 90%;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero {
            text-align: center;
            padding: 4rem 0;
            max-width: 1400px;
            margin: 0 auto;
        }

        .hero-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin: 0 auto 2rem;
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .authors {
            margin-top: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .authors span {
            padding: 0.75rem 1.5rem;
            background: #2d3748;
            color: white;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .feature-image {
            width: 100%;
            max-width: 1400px;
            margin: 3rem auto;
            display: block;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .placeholder-img {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
        }

        section {
            padding: 4rem 0;
            border-top: 1px solid var(--border-color);
        }

        section > p, section > h2, section > h3 {
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        h2 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            font-weight: 700;
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .skill-card {
            padding: 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s;
        }

        .skill-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .skill-card h4 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-box {
            text-align: center;
            padding: 2rem;
            background: var(--bg-light);
            border-radius: 12px;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-color);
            display: block;
        }

        .stat-label {
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            margin: 2rem auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            max-width: 1800px;
        }

        .table-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            max-width: 1800px;
            margin-left: auto;
            margin-right: auto;
        }

        select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            margin: 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: none;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #f3f4f6;
        }

        tr:hover {
            background: var(--bg-light);
        }

        .medal {
            font-size: 1.25rem;
        }

        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 2rem;
            border-radius: 12px;
            overflow-x: auto;
            position: relative;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        footer {
            margin-top: 4rem;
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
        }

        .back-to-top {
            display: inline-block;
            margin-top: 2rem;
            padding: 0.75rem 1.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .back-to-top:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .nav-links {
                display: none;
            }

            .skills-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .nav-content {
                padding: 0 1rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-content">
            <a href="#top" class="logo">
                &#119074; BASS
            </a>
            <ul class="nav-links">
                <li><a href="#abstract">Abstract</a></li>
                <li><a href="#results">Leaderboard</a></li>
                <li><a href="#full-table">Full Table</a></li>
                <li><a href="#stats">Stats</a></li>
                <li><a href="#analysis">Analysis</a></li>
                <!-- <li><a href="#bibtex">BibTeX</a></li> -->
            </ul>
        </div>
    </nav>

    <main>
        <div class="container">
            <section class="hero" id="top">
                <h1>&#119074; BASS</h1>
                <h4 class="subtitle"><b>B</b>enchmarking <b>A</b>udio LMs for Musical <b>S</b>tructure and <b>S</b>emantic Reasoning</h4>
                
                <div class="button-group">
                    <a href="#" class="btn btn-primary">üìÑ Download PDF</a>
                    <a href="#" class="btn btn-secondary">üêô Code</a>
                    <a href="#" class="btn btn-secondary">ü§ó Dataset</a>
                </div>

                <div class="authors">
                   <span>Min Jang<sup style="font-size: 1.3em;">*</sup></span>
                  <span>Orevaghene Ahia<sup style="font-size: 1.3em;">*</sup></span>
                    <span>Nazif Tamer</span>
                    <span>Sachin Kumar</span>
                    <span>Yulia Tsvetkov</span>
                    <span>Noah A. Smith</span>
                </div>
                <p style="margin-top: 0.5rem; font-size: 1.25rem; color: var(--text-light); text-align: center; font-style: italic;">
                <sup>*</sup> Equal contribution.
                </p>

                <h3>
                    University of Washington, Ohio Statue University, Allen Institute for AI
                </h3>


            </section>

            <img src="assets/main_figure.png" alt="Main Figure" class="feature-image">

            <p style="
                    margin: 2rem auto;
                    max-width: 1400px;
                    font-size: 1.1rem;
                    line-height: 1.8;
                    text-align: center;
                ">
                Overview of the tasks included in BASS, designed to evaluate audio LMs on musical understanding requiring long-term structure or hierarchical reasoning. It contains twelve tasks across four categories: structural segmentation, structural lyrics transcription, musicological analysis, and artist collaboration.
            </p>

            <section id="abstract">
                 <h2 style="text-align: center;">Abstract</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; max-width: 1400px; margin-left: auto; margin-right: auto;">
                    Music understanding is a complex task that often requires reasoning over both structural and semantic elements of audio. We introduce BASS, designed to evaluate music understanding and reasoning in audio language models across four broad categories: structural segmentation, lyric transcription, musicological analysis, and artist collaboration. BASS comprises 2658 questions spanning 12 tasks, 1993 unique songs and covering over 138 hours of music from a wide range of genres and tracks, crafted to assess musicological knowledge and reasoning in real-world scenarios. We evaluate 14 open-source and frontier multimodal LMs, finding that even state-of-the-art models struggle on higher-level reasoning tasks such as structural segmentation and artist collaboration, while performing best on lyric transcription. Our analysis reveals that current models leverage linguistic priors effectively but remain limited in reasoning over musical structure, vocal, and musicological attributes. BASS provides an evaluation framework with widespread applications in music recommendation and search and has the potential to guide the development of audio LMs.
                </p>
            </section>

            <section>
                <h2 style="text-align: center;">Metrics</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; max-width: 1400px; margin-left: auto; margin-right: auto;">
                    The metrics displayed in the leaderboard and table are normalized to be between 0-100%. For the Artist Collaboration and Musicological Analysis tasks, the exact match accuracies (EMA) are random chance normalized, so that the scores shows the improvement over random chance. For the Structural Lyrics Transcription tasks, the Inverted Word Error Rate (IWER) is used, which bounds the WER from 0-100%, and a higher score indicates better performance. The metric for Structural Segmentation, Intersection over Union (IoU), is already between 0-100%, so no further normalization is applied.
                </p>
            </section>


            <section id="results">
                <h2 style="text-align: center;">Model Performance ‚Äî Leaderboard</h2>
                <p style="margin-bottom: 1rem; max-width: 1800px; margin-left: auto; margin-right: auto;">Sorted by overall average (desc)</p>
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-light); max-width: 1800px; margin-left: auto; margin-right: auto;">
                    Medals: ü•á ü•à ü•â for top 3.
                </p>

                <div class="table-controls">
                    <label>
                        Sort by
                        <select id="sortBy">
                            <option value="overall" selected>Overall</option>
                            <option value="structural-lyrics-transcription">Structural Lyrics Transcription</option>
                            <option value="structural-segmentation">Structural Segmentation</option>
                            <option value="artist-collaboration">Artist Collaboration</option>
                            <option value="musicological-analysis">Musicological Analysis</option>
                        </select>
                    </label>
                </div>

                <div class="table-wrapper">
                    <table id="leaderboard">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Model</th>
                                <th>Size</th>
                                <th>Average (%)</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="full-table">

                <h2 style="text-align: center;">Full Results Table</h2>

                <div class="table-wrapper">
                    <table id="fullResultsTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Model</th>
                                <th>Speech</th>
                                <th>Sound</th>
                                <th>Music</th>
                                <th>Spatial</th>
                                <th>Multi-audio</th>
                                <th>Voice-chat</th>
                                <th>Instruction</th>
                                <th>Average</th>
                            </tr>
                        </thead>
                        <tbody id="fullTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="stats">
                <h2 style="text-align: center;">Data Statistics</h2>
                
                <h3 style="text-align: center; margin-bottom: 1rem;">Question Distribution</h3>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 2rem;">
                    Distribution of 2,658 questions across task categories and individual tasks
                </p>
                
                <div id="question-chart-container" style="display: flex; flex-direction: column; align-items: center; margin-bottom: 4rem;"></div>

                <h3 style="text-align: center;">Audio Statistics</h3>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Task</th>
                                <th># Songs</th>
                                <th>Avg.</th>
                                <th>Min.</th>
                                <th>Max.</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Lyrics -->
                            <tr>
                                <td rowspan="3"><strong>Structural Lyrics Transcription</strong></td>
                                <td>Full Structural Lyrics Transcription</td>
                                <td>665</td>
                                <td>3.73</td>
                                <td>1.60</td>
                                <td>11.72</td>
                            </tr>
                            <tr>
                                <td>Section Structural Lyrics Transcription</td>
                                <td>170</td>
                                <td>3.97</td>
                                <td>2.17</td>
                                <td>8.44</td>
                            </tr>
                            <tr>
                                <td><strong>Overall</strong></td>
                                <td><strong>884</strong></td>
                                <td><strong>3.78</strong></td>
                                <td><strong>1.60</strong></td>
                                <td><strong>11.72</strong></td>
                            </tr>

                            <!-- Structural Segmentation -->
                            <tr>
                                <td rowspan="3"><strong>Structural Segmentation</strong></td>
                                <td>Full Structural Segmentation</td>
                                <td>74</td>
                                <td>3.06</td>
                                <td>1.70</td>
                                <td>10.78</td>
                            </tr>
                            <tr>
                                <td>Section Structural Segmentation</td>
                                <td>224</td>
                                <td>3.47</td>
                                <td>1.93</td>
                                <td>9.31</td>
                            </tr>
                            <tr>
                                <td><strong>Overall</strong></td>
                                <td><strong>298</strong></td>
                                <td><strong>3.37</strong></td>
                                <td><strong>1.70</strong></td>
                                <td><strong>10.78</strong></td>
                            </tr>

                            <!-- Collaboration -->
                            <tr>
                                <td rowspan="5"><strong>Artist Collaboration</strong></td>
                                <td>Artist Counting</td>
                                <td>229</td>
                                <td>3.92</td>
                                <td>2.37</td>
                                <td>6.97</td>
                            </tr>
                            <tr>
                                <td>Arist Duration</td>
                                <td>327</td>
                                <td>3.83</td>
                                <td>1.34</td>
                                <td>6.97</td>
                            </tr>
                            <tr>
                                <td>Artist Localization</td>
                                <td>247</td>
                                <td>3.83</td>
                                <td>2.37</td>
                                <td>6.13</td>
                            </tr>
                            <tr>
                                <td>Artist Attribution</td>
                                <td>64</td>
                                <td>3.88</td>
                                <td>1.34</td>
                                <td>6.97</td>
                            </tr>
                            <tr>
                                <td><strong>Overall</strong></td>
                                <td><strong>327</strong></td>
                                <td><strong>3.83</strong></td>
                                <td><strong>1.34</strong></td>
                                <td><strong>6.97</strong></td>
                            </tr>

                            <!-- Music -->
                            <tr>
                                <td rowspan="5"><strong>Musicological Analysis</strong></td>
                                <td>Single-Gene Detection</td>
                                <td>335</td>
                                <td>3.15</td>
                                <td>1.86</td>
                                <td>9.23</td>
                            </tr>
                            <tr>
                                <td>Pairwise-Gene Detection</td>
                                <td>147</td>
                                <td>3.77</td>
                                <td>0.82</td>
                                <td>6.37</td>
                            </tr>
                            <tr>
                                <td>Gene Dominance Ranking</td>
                                <td>33</td>
                                <td>3.60</td>
                                <td>2.58</td>
                                <td>4.95</td>
                            </tr>
                            <tr>
                                <td>Gene Attribution</td>
                                <td>94</td>
                                <td>14.14</td>
                                <td>9.77</td>
                                <td>19.44</td>
                            </tr>
                            <tr>
                                <td><strong>Overall</strong></td>
                                <td><strong>484</strong></td>
                                <td><strong>5.57</strong></td>
                                <td><strong>0.82</strong></td>
                                <td><strong>19.44</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- <section id="analysis">
                <h2>Analysis</h2>
                <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                    The BASS benchmark reveals significant insights into current audio understanding capabilities. Models show varying strengths across different audio domains, with speech processing generally achieving higher accuracy than music and spatial audio understanding.
                </p>
                <p style="font-size: 1.1rem; line-height: 1.8;">
                    Multi-audio reasoning and long-form content processing remain challenging areas, highlighting opportunities for future model development. The benchmark also demonstrates that instruction-following capabilities in the audio domain lag behind those in visual and textual modalities.
                </p>
            </section> -->

            <!-- <section id="bibtex">
                <h2>BibTeX</h2>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyBibTeX()">üìã Copy BibTeX</button>
                    <pre id="bibtexCode">@article{kumar2025mmau,
  title={MMAU-Pro: A Challenging and Comprehensive Benchmark for Holistic Evaluation of Audio General Intelligence},
  author={Kumar, Sonal and Sedl√°ƒçek, ≈†imon and Lokegaonkar, Vaibhavi and L√≥pez, Fernando and Yu, Wenyi and Anand, Nishit and Ryu, Hyeonggon and Chen, Lichang and Pliƒçka, Maxim and Hlav√°ƒçek, Miroslav and others},
  journal={arXiv preprint arXiv:2508.13992},
  year={2025}
}</pre>
                </div>

                <h3 style="margin-top: 3rem;">Links & Contact</h3>
                <ul style="list-style: none; line-height: 2;">
                    <li>üìÑ Paper (PDF): <a href="https://arxiv.org/pdf/2508.13992" style="color: var(--primary-color);">Open</a></li>
                    <li>üêô Code: <a href="https://github.com/sonalkum/MMAUPro" style="color: var(--primary-color);">Repository</a></li>
                    <li>üîó Dataset: <a href="https://huggingface.co/datasets/gamma-lab-umd/MMAU-Pro" style="color: var(--primary-color);">Landing page</a></li>
                    <li>‚úâÔ∏è Corresponding author: sonalkum@umd.edu</li>
                </ul>
            </section> -->
        </div>
    </main>

    <footer>
        <div class="container">
            <a href="#top" class="back-to-top">‚Üë Back to Top</a>
        </div>
    </footer>

    <script>
        let leaderboardData = [];
        let fullTableData = [];

        // Model size mapping
        const modelSizes = {
            "Qwen3-Omni": "30B",
            "Step-Audio-R1": "33B",
            "Music Flamingo": "8B",
            "R1-AQA": "8.2B",
            "Gemma 3n": "5B",
            "Voxtral-Small-24B": "24B",
            "SALMONN-7B": "7B",
            "Phi4-mm-instruct": "5.5B",
            "Kimi Audio": "7B",
            "Mellow": "167M"
        };

        // 1. FIRST - Define renderLeaderboard
        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = leaderboardData.map(item => `
                <tr>
                    <td>${item.rank}</td>
                    <td>${item.medal} ${item.model}</td>
                    <td>${item.size}</td>
                    <td><strong>${item.average}%</strong></td>
                </tr>
            `).join('');
        }

        // 2. SECOND - Define renderFullTable
        function renderFullTable() {
            const tbody = document.getElementById('fullTableBody');
            const thead = document.querySelector('#fullResultsTable thead');

            if (!tbody || !thead || !window.headers) {
                return;
            }

            if (!leaderboardData || leaderboardData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="15" style="text-align: center;">Loading data...</td></tr>';
                return;
            }

            // Define task categories
            const categories = {
                'Structural Lyrics Transcription (IWER)': ['Full Structural Lyrics Transcription', 'Section Structural Lyrics Transcription'],
                'Structural Segmentation (IoU)': ['Full Structural Segmentation', 'Section Structural Segmentation'],
                'Artist Collaboration (EMA)': ['Artist Counting', 'Artist Duration', 'Artist Localization', 'Artist Attribution'],
                'Musicological Analysis (EMA)': ['Single-Gene Detection', 'Pairwise-Gene Detection', 'Gene Dominance Ranking', 'Song-Level Gene Detection'],
            };

            // Get all task headers (excluding Average)
            const displayHeaders = window.headers.slice(1).filter(h => h !== 'Average');

            // Build category header row
            let categoryHeaderHTML = '<th rowspan="2">#</th><th rowspan="2">Model</th>';
            let taskHeaderHTML = '';

            Object.entries(categories).forEach(([categoryName, tasks]) => {
                const tasksInData = tasks.filter(t => displayHeaders.includes(t));
                if (tasksInData.length > 0) {
                    categoryHeaderHTML += `<th colspan="${tasksInData.length}" style="text-align: center; background: #e5e7eb;">${categoryName}</th>`;
                    tasksInData.forEach(task => {
                        taskHeaderHTML += `<th>${task}</th>`;
                    });
                }
            });

            // Add remaining headers that don't belong to categories
            const categorizedTasks = Object.values(categories).flat();
            const uncategorizedHeaders = displayHeaders.filter(h => !categorizedTasks.includes(h));
            uncategorizedHeaders.forEach(h => {
                categoryHeaderHTML += `<th rowspan="2">${h}</th>`;
            });

            categoryHeaderHTML += '<th rowspan="2">Average</th>';

            // Update table header with two rows
            thead.innerHTML = `
                <tr>${categoryHeaderHTML}</tr>
                <tr>${taskHeaderHTML}</tr>
            `;

            // Build table body
            tbody.innerHTML = leaderboardData.map((item, idx) => {
                const categoryScores = displayHeaders.map(h => {
                    const value = item[h];
                    const displayValue = typeof value === 'number' ? value.toFixed(1) : '0.0';
                    return `<td>${displayValue}%</td>`;
                }).join('');

                const avgValue = item['Average'] || item.average || 0;
                const displayAvg = typeof avgValue === 'number' ? avgValue.toFixed(1) : avgValue;

                return `
                    <tr>
                        <td>${idx + 1}</td>
                        <td>${item.model}</td>
                        ${categoryScores}
                        <td><strong>${displayAvg}%</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // 3. THIRD - Define updateLeaderboard (calls renderLeaderboard)
        function updateLeaderboard(category) {
            const taskMapping = {
                'overall': ['Average'],
                'structural-segmentation': ['Full Structural Segmentation', 'Section Structural Segmentation'],
                'structural-lyrics-transcription': ['Full Structural Lyrics Transcription', 'Section Structural Lyrics Transcription'],
                'musicological-analysis': ['Single-Gene Detection', 'Pairwise-Gene Detection', 'Gene Dominance Ranking', 'Song-Level Gene Detection'],
                'artist-collaboration': ['Artist Counting', 'Artist Duration', 'Artist Attribution', 'Artist Localization']
            };

            const tasks = taskMapping[category];

            const dataWithAvg = window.allData.map(item => {
                let average;
                if (category === 'overall') {
                    average = item['Average'];
                } else {
                    const scores = tasks.map(task => item[task] || 0);
                    average = scores.reduce((a, b) => a + b, 0) / scores.length;
                }

                return {
                    ...item,
                    average: average.toFixed(1)
                };
            });

            dataWithAvg.sort((a, b) => parseFloat(b.average) - parseFloat(a.average));

            leaderboardData = dataWithAvg.map((item, idx) => ({
                ...item,
                rank: idx + 1,
                medal: idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : ''
            }));

            renderLeaderboard();
        }

        // 4. FOURTH - Define loadCSVData (calls updateLeaderboard)
        async function loadCSVData() {
            try {
                const response = await fetch('data/normalized_results.csv');
                const csvText = await response.text();

                const rows = csvText.split('\n').filter(row => row.trim());
                const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));

                const data = [];
                for (let i = 1; i < rows.length; i++) {
                    const values = rows[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    if (values.length > 1 && values[0]) {
                        const modelName = values[0];

                        const rowData = {
                            model: modelName,
                            size: modelSizes[modelName] || '--'
                        };

                        headers.slice(1).forEach((header, idx) => {
                            rowData[header] = parseFloat(values[idx + 1]) || 0;
                        });

                        data.push(rowData);
                    }
                }

                window.allData = data;
                window.headers = headers;

                updateLeaderboard('overall');
                renderFullTable();
            } catch (error) {
                console.error('Error loading CSV:', error);
                document.getElementById('leaderboardBody').innerHTML =
                    '<tr><td colspan="4" style="text-align: center; color: red;">Error loading data. Please check the CSV file path.</td></tr>';
            }
        }

        function copyBibTeX() {
            const bibtex = document.getElementById('bibtexCode').textContent;
            navigator.clipboard.writeText(bibtex).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úì Copied!';
                setTimeout(() => {
                    btn.textContent = 'üìã Copy BibTeX';
                }, 2000);
            });
        }

        // Smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Add event listener for sort dropdown
        document.getElementById('sortBy').addEventListener('change', function(e) {
            updateLeaderboard(e.target.value);
        });

        // Initialize tables by loading CSV
        loadCSVData();

        // Function to generate question distribution pie chart
        function generateQuestionDistributionChart(containerId = 'question-chart-container', width = 800, height = 800) {
            // Data structure with categories and their tasks
            const data = {
                name: 'BASS Questions',
                children: [
                    {
                        name: 'Structural Segmentation',
                        color: '#2563eb', // Blue
                        children: [
                            { name: 'Full Structural Segmentation', value: 74 },
                            { name: 'Section Structural Segmentation', value: 224 }
                        ]
                    },
                    {
                        name: 'Structural Lyrics Transcription',
                        color: '#10b981', // Green
                        children: [
                            { name: 'Full Structural Lyrics Transcription', value: 665 },
                            { name: 'Section Structural Lyrics Transcription', value: 170 }
                        ]
                    },
                    {
                        name: 'Musicological Analysis',
                        color: '#f59e0b', // Orange
                        children: [
                            { name: 'Single-Gene Detection', value: 335 },
                            { name: 'Pairwise-Gene Detection', value: 147 },
                            { name: 'Gene Dominance Ranking', value: 33 },
                            { name: 'Gene Attribution', value: 94 }
                        ]
                    },
                    {
                        name: 'Artist Collaboration',
                        color: '#8b5cf6', // Purple
                        children: [
                            { name: 'Artist Counting', value: 229 },
                            { name: 'Artist Duration', value: 327 },
                            { name: 'Artist Localization', value: 247 },
                            { name: 'Artist Attribution', value: 64 }
                        ]
                    }
                ]
            };

            // Calculate totals for each category
            data.children.forEach(category => {
                category.value = category.children.reduce((sum, task) => sum + task.value, 0);
            });

            const totalQuestions = data.children.reduce((sum, cat) => sum + cat.value, 0);

            // Clear the container
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            // Create SVG
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const centerX = width / 2;
            const centerY = height / 2;
            const outerRadius = Math.min(width, height) / 2 - 60;
            const innerRadius = outerRadius * 0.5;
            const categoryRadius = outerRadius * 0.75;

            // Helper function to create SVG path for arc
            function createArcPath(startAngle, endAngle, innerR, outerR) {
                const startAngleRad = (startAngle - 90) * Math.PI / 180;
                const endAngleRad = (endAngle - 90) * Math.PI / 180;

                const x1 = centerX + outerR * Math.cos(startAngleRad);
                const y1 = centerY + outerR * Math.sin(startAngleRad);
                const x2 = centerX + outerR * Math.cos(endAngleRad);
                const y2 = centerY + outerR * Math.sin(endAngleRad);
                const x3 = centerX + innerR * Math.cos(endAngleRad);
                const y3 = centerY + innerR * Math.sin(endAngleRad);
                const x4 = centerX + innerR * Math.cos(startAngleRad);
                const y4 = centerY + innerR * Math.sin(startAngleRad);

                const largeArc = endAngle - startAngle > 180 ? 1 : 0;

                return `M ${x1} ${y1} A ${outerR} ${outerR} 0 ${largeArc} 1 ${x2} ${y2} L ${x3} ${y3} A ${innerR} ${innerR} 0 ${largeArc} 0 ${x4} ${y4} Z`;
            }

            // Helper function to lighten/darken colors
            function adjustColor(color, amount) {
                const num = parseInt(color.replace('#', ''), 16);
                const r = Math.min(255, Math.max(0, (num >> 16) + amount));
                const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
                const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
                return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
            }

            // Create group for chart
            const chartGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');

            let currentAngle = 0;

            // Draw outer ring (categories) and inner ring (tasks)
            data.children.forEach((category, categoryIndex) => {
                const categoryAngle = (category.value / totalQuestions) * 360;
                const categoryEndAngle = currentAngle + categoryAngle;

                // Draw outer category arc
                const categoryPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                categoryPath.setAttribute('d', createArcPath(currentAngle, categoryEndAngle, categoryRadius, outerRadius));
                categoryPath.setAttribute('fill', category.color);
                categoryPath.setAttribute('stroke', 'white');
                categoryPath.setAttribute('stroke-width', '2');
                categoryPath.setAttribute('class', 'category-segment');
                
                // Add hover effect
                categoryPath.addEventListener('mouseenter', function() {
                    this.style.opacity = '0.8';
                    this.style.cursor = 'pointer';
                });
                categoryPath.addEventListener('mouseleave', function() {
                    this.style.opacity = '1';
                });

                // Add title for tooltip
                const categoryTitle = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                categoryTitle.textContent = `${category.name}: ${category.value} questions (${(category.value / totalQuestions * 100).toFixed(1)}%)`;
                categoryPath.appendChild(categoryTitle);

                chartGroup.appendChild(categoryPath);

                // Draw inner task arcs
                let taskStartAngle = currentAngle;
                category.children.forEach((task, taskIndex) => {
                    const taskAngle = (task.value / totalQuestions) * 360;
                    const taskEndAngle = taskStartAngle + taskAngle;

                    // Create lighter shade of category color for tasks
                    const taskColor = adjustColor(category.color, 30 + (taskIndex * 15));

                    const taskPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    taskPath.setAttribute('d', createArcPath(taskStartAngle, taskEndAngle, innerRadius, categoryRadius));
                    taskPath.setAttribute('fill', taskColor);
                    taskPath.setAttribute('stroke', 'white');
                    taskPath.setAttribute('stroke-width', '2');
                    taskPath.setAttribute('class', 'task-segment');

                    // Add hover effect
                    taskPath.addEventListener('mouseenter', function() {
                        this.style.opacity = '0.8';
                        this.style.cursor = 'pointer';
                    });
                    taskPath.addEventListener('mouseleave', function() {
                        this.style.opacity = '1';
                    });

                    // Add title for tooltip
                    const taskTitle = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                    taskTitle.textContent = `${task.name}: ${task.value} questions (${(task.value / totalQuestions * 100).toFixed(1)}%)`;
                    taskPath.appendChild(taskTitle);

                    chartGroup.appendChild(taskPath);

                    taskStartAngle = taskEndAngle;
                });

                currentAngle = categoryEndAngle;
            });

            svg.appendChild(chartGroup);

            // Add center circle with total
            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', innerRadius);
            centerCircle.setAttribute('fill', '#f9fafb');
            centerCircle.setAttribute('stroke', '#e5e7eb');
            centerCircle.setAttribute('stroke-width', '2');
            svg.appendChild(centerCircle);

            // Add center text
            const centerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText.setAttribute('x', centerX);
            centerText.setAttribute('y', centerY - 10);
            centerText.setAttribute('text-anchor', 'middle');
            centerText.setAttribute('font-size', '32');
            centerText.setAttribute('font-weight', 'bold');
            centerText.setAttribute('fill', '#1f2937');
            centerText.textContent = totalQuestions;
            svg.appendChild(centerText);

            const centerLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerLabel.setAttribute('x', centerX);
            centerLabel.setAttribute('y', centerY + 20);
            centerLabel.setAttribute('text-anchor', 'middle');
            centerLabel.setAttribute('font-size', '16');
            centerLabel.setAttribute('fill', '#6b7280');
            centerLabel.textContent = 'Total Questions';
            svg.appendChild(centerLabel);

            container.appendChild(svg);

            // Create legend
            const legend = document.createElement('div');
            legend.style.marginTop = '30px';
            legend.style.display = 'grid';
            legend.style.gridTemplateColumns = 'repeat(auto-fit, minmax(250px, 1fr))';
            legend.style.gap = '20px';
            legend.style.maxWidth = '1400px';

            data.children.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.style.marginBottom = '10px';

                const categoryHeader = document.createElement('div');
                categoryHeader.style.display = 'flex';
                categoryHeader.style.alignItems = 'center';
                categoryHeader.style.marginBottom = '8px';
                categoryHeader.style.fontWeight = 'bold';

                const categoryColorBox = document.createElement('div');
                categoryColorBox.style.width = '20px';
                categoryColorBox.style.height = '20px';
                categoryColorBox.style.backgroundColor = category.color;
                categoryColorBox.style.marginRight = '10px';
                categoryColorBox.style.borderRadius = '3px';

                const categoryName = document.createElement('span');
                categoryName.textContent = `${category.name} (${category.value})`;

                categoryHeader.appendChild(categoryColorBox);
                categoryHeader.appendChild(categoryName);
                categoryDiv.appendChild(categoryHeader);

                // Add tasks
                category.children.forEach((task, index) => {
                    const taskDiv = document.createElement('div');
                    taskDiv.style.display = 'flex';
                    taskDiv.style.alignItems = 'center';
                    taskDiv.style.marginLeft = '30px';
                    taskDiv.style.marginBottom = '4px';
                    taskDiv.style.fontSize = '14px';

                    const taskColorBox = document.createElement('div');
                    taskColorBox.style.width = '16px';
                    taskColorBox.style.height = '16px';
                    taskColorBox.style.backgroundColor = adjustColor(category.color, 30 + (index * 15));
                    taskColorBox.style.marginRight = '8px';
                    taskColorBox.style.borderRadius = '2px';

                    const taskName = document.createElement('span');
                    taskName.textContent = `${task.name} (${task.value})`;

                    taskDiv.appendChild(taskColorBox);
                    taskDiv.appendChild(taskName);
                    categoryDiv.appendChild(taskDiv);
                });

                legend.appendChild(categoryDiv);
            });

            container.appendChild(legend);

            return {
                svg,
                legend,
                data,
                totalQuestions
            };
        }

        // Generate the question distribution chart
        generateQuestionDistributionChart('question-chart-container', 800, 800);
    </script>
</body>
</html>